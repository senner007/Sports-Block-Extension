(()=>{"use strict";var e={844:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentController=void 0;const n=s(150);t.ContentController=class{contentView;contentMediator;host;isSelectMode=!1;isFilterResultsOnly=!1;constructor(e,t,s){this.contentView=e,this.contentMediator=t,this.host=s,this.contentMediator.receiveListener(this.messageReceiverStorageUpdate),this.contentMediator.receiveListener(this.messageReceiverSelectMode),this.contentMediator.receiveListener(this.messageReceiverfilterByResults),this.contentMediator.receiveListener(this.messageReceiverGetElementsRemoved)}async init(){this.isFilterResultsOnly=await this.contentMediator.getFilterByResultsState(),await this.markElements(this.contentView.root),setTimeout((()=>{this.observeElements((async e=>{await this.markElements(e),(await this.findRelatedElems(e)).elemsToBeHidden.length>0&&this.contentMediator.DomChangeUpdate()}))}),0),this.createModal()}messageReceiverGetElementsRemoved=(e,t,s)=>{if(n.MESSAGE_TOPICS.GET_ELEMENTS_REMOVED)return(async()=>{const e=await this.findRelatedElems(this.contentView.root);s(e.elemsToBeHidden.map((e=>({url:e.href,labels:this.host.getLabels(e.href)}))))})(),!0};createModal=()=>{this.contentView.createModal(this.modalCallback)};modalCallback=()=>{this.messageReceiverSelectMode({topic:n.MESSAGE_TOPICS.ELEMENT_SELECT_MODE_OFF,message:""})};messageReceiverSelectMode=async(e,t,s)=>{e.topic!==n.MESSAGE_TOPICS.ELEMENT_SELECT_MODE_ON&&e.topic!==n.MESSAGE_TOPICS.ELEMENT_SELECT_MODE_OFF||(this.isSelectMode=e.topic===n.MESSAGE_TOPICS.ELEMENT_SELECT_MODE_ON,await this.markElements(this.contentView.root),this.isSelectMode?this.contentView.openModal():this.contentView.closeModal())};locateForRemovalListener=async e=>{let t=this.host.getLabels(e);const s=await this.getCategories();this.contentView.appendToModal(t),await this.contentMediator.setCategories(Array.from(new Set([...s,...t])))};messageReceiverStorageUpdate=async(e,t,s)=>{e.topic===n.MESSAGE_TOPICS.STORAGE_UPDATE&&(await this.markElements(this.contentView.root),setTimeout((()=>{this.contentMediator.DomChangeUpdate()}),0))};messageReceiverfilterByResults=async(e,t,s)=>{e.topic!==n.MESSAGE_TOPICS.FILTER_BY_RESULTS_MODE_ON&&e.topic!==n.MESSAGE_TOPICS.FILTER_BY_RESULTS_MODE_OFF||(this.isFilterResultsOnly=e.topic===n.MESSAGE_TOPICS.FILTER_BY_RESULTS_MODE_ON,await this.markElements(this.contentView.root),setTimeout((()=>{this.contentMediator.DomChangeUpdate()}),0))};async getCategories(){return await this.contentMediator.getCategories()||[]}async findElementsOnPage(e){return this.contentView.getElements(this.host.sportsSection,e)}checkIfResults=async e=>{const t=await this.contentMediator.requestUrlHTML({url:e.href});if(null===t)return!1;const s=this.contentView.parseUrl(this.host,t),n=await this.contentMediator.requestModelEvaluate({sentence:s});return console.log("PARSED :",s,"\nRESULT:",n),n>.5};observeElements(e){this.contentView.observeElements(e)}findRelatedElems=async e=>{const t=await this.getCategories(),s=await this.findElementsOnPage(e);if(0===s.length)return{elemsToBeHidden:[],remaining:[]};const n=s.filter((e=>{const s=this.host.getLabels(e.href);for(const e of s)if(t.includes(e.toLowerCase()))return!0;return!1})),o=s.filter((e=>!n.map((e=>e.href)).includes(e.href))),a=[];for(const e of n)this.isFilterResultsOnly?await this.checkIfResults(e)&&a.push(e):a.push(e);return{elemsToBeHidden:a,remaining:o,allElems:s}};markElements=async e=>{const t=await this.findRelatedElems(e);t.allElems?.forEach((e=>this.contentView.clearSelection(e.elem))),t.elemsToBeHidden.forEach((e=>this.contentView.hideElement(e.elem))),t.remaining.forEach((e=>this.contentView.tagForRemoval(e.elem,this.isSelectMode?"ON":"OFF",this.locateForRemovalListener)))}}},343:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContentView=void 0;const n=s(593);t.ContentView=class{tagClass="sports-block-extension-locate";hideClass="sports-block-extension-hide";locateListenerInstance;modalClassName="extension-modal";modalContentPathsClassName="modal-content-paths";root=document;clearSelection(e){e.classList.remove(this.hideClass),e.classList.remove(this.tagClass),e.removeEventListener("click",this.locateListenerInstance)}tagForRemoval(e,t,s){"ON"===t?(e.classList.add(this.tagClass),this.addLocateForRemovalListeners(e,s)):e.classList.remove(this.tagClass)}hideElement(e){e.classList.add(this.hideClass)}locateListener(e){return function(t){t.preventDefault();const s=t.target.querySelector("a").href;e(s)}}createModal=e=>{var t=document.createElement("div");t.classList.add(this.modalClassName),t.innerHTML=`<div class="extension-modal-content">\n            <div class="extension-modal-container">\n                <div><h3>Select elements to hide</h3></div>\n                <div class="extension-modal-close">&times;</div>\n            </div>\n            <p>(click close when done)</p>\n            <ul class="${this.modalContentPathsClassName}"></ul>\n        </div>`,document.body.appendChild(t),document.querySelector(".extension-modal-close")?.addEventListener("click",(()=>{this.closeModal(),e()}))};appendToModal=e=>{const t=document.querySelector("."+this.modalContentPathsClassName),s=Array.from(t.querySelectorAll("li")).map((e=>e.textContent)),n=Array.from(new Set([...s,...e]));this.clearModelContent();for(const e of n){var o=document.createElement("li");o.innerHTML=e,t.appendChild(o)}};clearModelContent=()=>{const e=document.querySelector("."+this.modalContentPathsClassName);(0,n.removeChildNodes)(e)};openModal=()=>{const e=document.querySelector("."+this.modalClassName);this.clearModelContent(),e.style.display="block"};closeModal=()=>{try{document.querySelector("."+this.modalClassName).style.display="none"}catch(e){console.log("Modal not loaded yet")}};addLocateForRemovalListeners(e,t){this.locateListenerInstance=this.locateListenerInstance?this.locateListenerInstance:this.locateListener(t),e.addEventListener("click",this.locateListenerInstance)}parseUrl(e,t){var s=document.createElement("div");s.innerHTML=t;let o=e.parser(s);return(0,n.removeTRailingFullStopAndSpace)(o.join(" . "))}observeElements(e){const t=document.documentElement;new MutationObserver((async(t,s)=>{for(const s of t)await e(s.target)})).observe(t,{childList:!0,subtree:!0,characterData:!1})}getElements(e,t){const s=Array.from(t.querySelectorAll("a")).filter((t=>t.href.includes(e))).filter((e=>e.href.includes("-"))).map((e=>n(e)));function n(e){const t=e.parentElement?.querySelectorAll("a");return[...new Set(Array.from(t).map((e=>e.href)))].length>1?e:n(e.parentElement)}const o=[];return s.forEach((e=>{o.some((t=>e.isEqualNode(t)))||o.push(e)})),o.map((e=>{let t;return t="href"in e?e.querySelector("a")||e:e.querySelector("a"),{elem:e,pathname:t.pathname,href:t.href}}))}}},150:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uiMediator=t.contentMediator=t.MESSAGE_TOPICS=void 0;const n=s(912);var o;!function(e){e[e.ELEMENT_SELECT_MODE_ON=0]="ELEMENT_SELECT_MODE_ON",e[e.ELEMENT_SELECT_MODE_OFF=1]="ELEMENT_SELECT_MODE_OFF",e[e.FILTER_BY_RESULTS_MODE_ON=2]="FILTER_BY_RESULTS_MODE_ON",e[e.FILTER_BY_RESULTS_MODE_OFF=3]="FILTER_BY_RESULTS_MODE_OFF",e[e.CONTENT_DOM_CHANGE=4]="CONTENT_DOM_CHANGE",e[e.GET_ELEMENTS_REMOVED=5]="GET_ELEMENTS_REMOVED",e[e.REQUEST_URL=6]="REQUEST_URL",e[e.REQUEST_MODEL_EVALUATION=7]="REQUEST_MODEL_EVALUATION",e[e.STORAGE_UPDATE=8]="STORAGE_UPDATE"}(o||(t.MESSAGE_TOPICS=o={}));class a{async receiveListener(e){chrome.runtime.onMessage.addListener(e)}async setCategories(e){return n.extensionStorage.storage_set("categories",e)}async getCategories(){return n.extensionStorage.storage_get("categories")}async getFilterByResultsState(){return n.extensionStorage.storage_get("filterByResultState")}}t.contentMediator=new class extends a{urlsCache={};evaluationCache={};pending=Promise.resolve("");modelPending=Promise.resolve(0);async sendMessage(e,t){return await chrome.runtime.sendMessage({topic:e,message:t})}async urlTaskrunner(e){try{await this.pending}finally{if(e.url in this.urlsCache)return this.urlsCache[e.url];try{console.log("fetching");const t=await this.sendMessage(o.REQUEST_URL,{url:e.url});return this.urlsCache[e.url]=t,"ERROR"===t?null:t}catch(e){throw console.log("fetch error:",e),new Error}}}async modelTaskrunner(e){try{await this.modelPending}finally{if(e.sentence in this.evaluationCache)return this.evaluationCache[e.sentence];{const t=await this.sendMessage(o.REQUEST_MODEL_EVALUATION,{sentence:e.sentence});return this.evaluationCache[e.sentence]=t,t}}}async requestUrlHTML(e){return this.pending=this.urlTaskrunner(e),this.pending}async requestModelEvaluate(e){return this.modelPending=this.modelTaskrunner(e),this.modelPending}async DomChangeUpdate(){await this.sendMessage(o.CONTENT_DOM_CHANGE,{})}},t.uiMediator=new class extends a{async getElemsRemoved(){const e=await this.sendMessage(o.GET_ELEMENTS_REMOVED,"");return console.log(e),e}async sendMessage(e,t){const s=await chrome.tabs.query({active:!0,lastFocusedWindow:!0}),n=await chrome.tabs.sendMessage(s[0].id,{topic:e,mesage:t});return console.log(n),n}async sendMessageStorageUpdate(){await this.sendMessage(o.STORAGE_UPDATE,"")}async setFilterByResultsState(e){await n.extensionStorage.storage_set("filterByResultState","ON"===e),await this.sendMessage("ON"===e?o.FILTER_BY_RESULTS_MODE_ON:o.FILTER_BY_RESULTS_MODE_OFF,"")}async requestElementSelectMode(e){await this.sendMessage("ON"===e?o.ELEMENT_SELECT_MODE_ON:o.ELEMENT_SELECT_MODE_OFF,"")}}},912:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extensionStorage=void 0,t.extensionStorage=new class{async storage_get(e){return(await chrome.storage.sync.get(e))[e]}async storage_set(e,t){chrome.storage.sync.set({[e]:t})}}},593:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeTRailingFullStopAndSpace=t.removeChildNodes=void 0,t.removeChildNodes=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},t.removeTRailingFullStopAndSpace=function(e){let t=e.trim();return"."===t[t.length-1]&&(t=t.slice(0,-1)),t}}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}(()=>{const e=s(150),t=s(844),n=s(343);(async()=>{window.onload=async function(){console.log("WINDIW LOADED EVENT");const s=new t.ContentController(new n.ContentView,e.contentMediator,function(){const e=window.location.host;if("www.dr.dk"===e)return{location:e,sportsSection:e+"/sporten",sportsPath:"/sporten",getLabels(e){const t=e.replace("https://"+this.sportsSection,"").split("/").filter((e=>e.length>0)).filter(((e,t,s)=>t<s.length-1));return 0===t.length?["sport"]:t},parser(e){const t=e.querySelector(".dre-article-title-section-label__title--link")?.textContent||e.querySelector(".dre-teaser-meta-label.dre-teaser-meta-label--primary")?.textContent,s=e.querySelector(".dre-title-text")?.textContent;return[t,s,e.querySelector(".dre-article-title__summary")?.textContent||e.querySelector(".hydra-latest-news-page-short-news-article__paragraph.dre-variables")?.textContent]}};if("nyheder.tv2.dk"===e||"tv2.dk"===e)return{location:e,sportsSection:"sport.tv2.dk",sportsPath:"",getLabels(e){const t=e.replace("https://"+this.sportsSection,"").split("/").filter((e=>e.length>0)).filter(((e,t,s)=>t<s.length-1));return 0===t.length?["Sport"]:t},parser(e){const t=e.querySelector(".tc_page__label")?.childNodes[0].textContent,s=e.querySelector(".tc_heading.tc_heading--2")?.childNodes[0].textContent;return[t,s,e.querySelector(".tc_page__body__standfirst")?.childNodes[0].childNodes[0].textContent||e.querySelector(".tc_richcontent")?.firstChild.textContent]}};throw new Error("host undefined")}());await s.init()}})()})()})();