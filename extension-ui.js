(()=>{"use strict";var e={329:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UIController=void 0;const n=s(150);t.UIController=class{UIView;uiMediator;constructor(e,t){this.UIView=e,this.uiMediator=t,e.toggleElementSelectButton(this.elementSelectModeToggle),e.toggleFilterByResultsButton(this.filterByResultsToggle),this.uiMediator.requestElementSelectMode("OFF"),this.displayFilterByResultsState(),this.displayRemovedElements(),this.uiMediator.receiveListener(this.onContentDomChange),this.setupCategories()}setupCategories=async()=>{const e=await this.uiMediator.getCategories();this.UIView.displayCategories(e),this.UIView.clickCategory(this.clickCategoryCallback)};clickCategoryCallback=async e=>{const t=(await this.uiMediator.getCategories()).filter((t=>t!==e));await this.uiMediator.setCategories(t),await this.uiMediator.sendMessageStorageUpdate(),this.setupCategories()};async displayRemovedElements(){const e=await this.uiMediator.getElemsRemoved(),t=e.filter(((t,s)=>e.findIndex((e=>e.url===t.url))===s));this.UIView.displayRemovedElements(t)}onContentDomChange=async(e,t,s)=>{e.topic===n.MESSAGE_TOPICS.CONTENT_DOM_CHANGE&&await this.displayRemovedElements()};async displayFilterByResultsState(){const e=await this.uiMediator.getFilterByResultsState();this.UIView.displayFilterByResultsButton(e?"ON":"OFF")}elementSelectModeToggle=async e=>{await this.uiMediator.requestElementSelectMode(e)};filterByResultsToggle=async e=>{await this.uiMediator.setFilterByResultsState(e)}}},290:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uiView=void 0;const n=s(593);t.uiView=new class{filterByReesultsId="#filterByResultsButton";resultsButton=document.querySelector(this.filterByReesultsId);categories="#categories";elementSelectButton="#elementSelectButton";category=".category";elementsRemoved="#elementsRemoved";displayCategories(e){const t=document.querySelector(this.categories);(0,n.removeChildNodes)(t);for(const n of e){var s=document.createElement("li");s.innerHTML=`<span>\n                <span class="categoryText">${n}</span>\n                <span class="close">&times;</span>\n            </span>`,s.classList.add("category"),t?.appendChild(s)}}displayRemovedElements(e){const t=document.querySelector(this.elementsRemoved);(0,n.removeChildNodes)(t);for(const s of e){const e=document.createElement("li");e.innerHTML=`<span>\n            <a href="${s.url}" target="_blank">${s.url}</a>\n            <span>${s.labels.join(",")}</span>\n        </span>`,t.appendChild(e)}}displayFilterByResultsButton(e){this.resultsButton.checked="ON"===e}toggleElementSelectButton(e){document.querySelector(this.elementSelectButton)?.addEventListener("click",(async t=>{const s=t.target;s.classList.toggle("ON"),e(s.classList.contains("ON")?"ON":"OFF")}))}toggleFilterByResultsButton(e){this.resultsButton?.addEventListener("click",(async t=>{e(t.target.checked?"ON":"OFF")}))}clickCategory(e){document.querySelectorAll(this.category).forEach((t=>{t.addEventListener("click",(t=>{const s=t.target.closest("li")?.querySelector(".categoryText"),n=s.textContent;e(n)}))}))}}},150:(e,t,s)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.uiMediator=t.contentMediator=t.MESSAGE_TOPICS=void 0;const n=s(912);var i;!function(e){e[e.ELEMENT_SELECT_MODE_ON=0]="ELEMENT_SELECT_MODE_ON",e[e.ELEMENT_SELECT_MODE_OFF=1]="ELEMENT_SELECT_MODE_OFF",e[e.FILTER_BY_RESULTS_MODE_ON=2]="FILTER_BY_RESULTS_MODE_ON",e[e.FILTER_BY_RESULTS_MODE_OFF=3]="FILTER_BY_RESULTS_MODE_OFF",e[e.CONTENT_DOM_CHANGE=4]="CONTENT_DOM_CHANGE",e[e.GET_ELEMENTS_REMOVED=5]="GET_ELEMENTS_REMOVED",e[e.REQUEST_URL=6]="REQUEST_URL",e[e.REQUEST_MODEL_EVALUATION=7]="REQUEST_MODEL_EVALUATION",e[e.STORAGE_UPDATE=8]="STORAGE_UPDATE"}(i||(t.MESSAGE_TOPICS=i={}));class a{async receiveListener(e){chrome.runtime.onMessage.addListener(e)}async setCategories(e){return n.extensionStorage.storage_set("categories",e)}async getCategories(){return n.extensionStorage.storage_get("categories")}async getFilterByResultsState(){return n.extensionStorage.storage_get("filterByResultState")}}t.contentMediator=new class extends a{urlsCache={};evaluationCache={};pending=Promise.resolve("");modelPending=Promise.resolve(0);async sendMessage(e,t){return await chrome.runtime.sendMessage({topic:e,message:t})}async urlTaskrunner(e){try{await this.pending}finally{if(e.url in this.urlsCache)return this.urlsCache[e.url];try{console.log("fetching");const t=await this.sendMessage(i.REQUEST_URL,{url:e.url});return this.urlsCache[e.url]=t,"ERROR"===t?null:t}catch(e){throw console.log("fetch error:",e),new Error}}}async modelTaskrunner(e){try{await this.modelPending}finally{if(e.sentence in this.evaluationCache)return this.evaluationCache[e.sentence];{const t=await this.sendMessage(i.REQUEST_MODEL_EVALUATION,{sentence:e.sentence});return this.evaluationCache[e.sentence]=t,t}}}async requestUrlHTML(e){return this.pending=this.urlTaskrunner(e),this.pending}async requestModelEvaluate(e){return this.modelPending=this.modelTaskrunner(e),this.modelPending}async DomChangeUpdate(){await this.sendMessage(i.CONTENT_DOM_CHANGE,{})}},t.uiMediator=new class extends a{async getElemsRemoved(){const e=await this.sendMessage(i.GET_ELEMENTS_REMOVED,"");return console.log(e),e}async sendMessage(e,t){const s=await chrome.tabs.query({active:!0,lastFocusedWindow:!0}),n=await chrome.tabs.sendMessage(s[0].id,{topic:e,mesage:t});return console.log(n),n}async sendMessageStorageUpdate(){await this.sendMessage(i.STORAGE_UPDATE,"")}async setFilterByResultsState(e){await n.extensionStorage.storage_set("filterByResultState","ON"===e),await this.sendMessage("ON"===e?i.FILTER_BY_RESULTS_MODE_ON:i.FILTER_BY_RESULTS_MODE_OFF,"")}async requestElementSelectMode(e){await this.sendMessage("ON"===e?i.ELEMENT_SELECT_MODE_ON:i.ELEMENT_SELECT_MODE_OFF,"")}}},912:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.extensionStorage=void 0,t.extensionStorage=new class{async storage_get(e){return(await chrome.storage.sync.get(e))[e]}async storage_set(e,t){chrome.storage.sync.set({[e]:t})}}},593:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeTRailingFullStopAndSpace=t.removeChildNodes=void 0,t.removeChildNodes=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},t.removeTRailingFullStopAndSpace=function(e){let t=e.trim();return"."===t[t.length-1]&&(t=t.slice(0,-1)),t}}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,s),a.exports}(()=>{const e=s(150),t=s(329),n=s(290);new t.UIController(n.uiView,e.uiMediator),console.log("This is the UI console!")})()})();